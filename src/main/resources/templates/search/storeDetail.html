<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>맛집 상세 페이지</title>
<link rel="stylesheet" href="/css/storeDetail.css">
<script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=1tepft4p0ed&submodules=geocoder"></script>
<script src="/js/storeDetail.js"></script>
<style>

</style>
</head>
<body>
	<th:block th:include="common/header"></th:block>
	<div class="page-content">
		<div class="store-head">
			<div class="img-zone" style="width:520px;">
				<!-- 사진 경로 : static > photo > store -->
				<img th:src="@{'/photo/store/' + ${store.storeImg}}" style="max-width:100%; max-height:100%;">
			</div>
			<div class="store-title">
				<div class="store-name">
					<h1 th:text="${store.storeName}"></h1>
				</div>
				<div class="store-like">하트</div>
				<div class="store-star">별점</div>
				<div class="store-report">신고</div>
				<div class="store-info">
					<div class="store-addr">
						<h3>
							<span th:text="${store.storeAddr}"></span>
   							<span th:text="${store.storeAddr1}"></span>
						</h3>
					</div>
					<div class="store-phone">
						<h3>
							<span th:text="${store.storePhone}"></span>
						</h3>
					</div>
					<div class="store-hours">
						<h3>
							<span th:text="${store.openingHour}"></span>
							<span>~</span>
							<span th:text="${store.closingHour}"></span>
							<span>( 휴무일 :</span>
							<span th:each="closedDayList : ${closedDayList}">
								<span th:text="${closedDayList.closedDay}"></span>
				   			</span>
							<span th:if="${#lists.isEmpty(closedDayList)}">
				       			<a>X</a>
				   			</span>
							<span>)</span>
						</h3>
					</div>
					<div class="store-intro">
						<span th:text="${store.storeDescription}"></span>
					</div>
					<div class="icon-zone">
						<a th:if="${store.homePage != null}" th:href="${store.homePage}" target="_blank">
							<img src="/img/home.png" width="24px">
						</a>
						<a th:if="${store.storeSns != null}" th:href="${store.storeSns}" target="_blank">
							<img src="/img/sns.png" width="24px">
						</a>
					</div>
				</div>
			</div>
		</div>
		
		<div class="store-section">
			<div>
				<div class="section-title">위치</div>
				<div id="map" style="width:379px;height:360px;"></div>
			</div>
			<div>
				<div class="section-title">메뉴</div>
				<div class="menu" style="height:360px; overflow-y: auto;">
				    <div th:each="menuList : ${menuList}" style="display: flex; align-items: center; margin-bottom: 10px;">
				        <img th:src="@{'/photo/store/' + ${menuList.menuImg}}" style="max-width:140px; max-height:140px; margin-right: 10px;">
				        <div style="flex-grow: 1;">
				            <span th:text="${menuList.menuName}" style="display: block; font-weight: bold;"></span>
				            <span th:text="'가격: ' + ${menuList.menuPrice}" style="display: block;"></span>
				        </div>
				    </div>
				    <div th:if="${#lists.isEmpty(menuList)}">
				        <span>등록된 메뉴가 없습니다.</span>
				    </div>
				</div>
			</div>
			<div>
				<div class="section-title">안내</div>
				<div class="store-intro" style="height:360px;">
				    <textarea id="infoContent" rows="10" style="width:100%; height:300px; resize:none;" th:text="${info != null} ? ${info.infoContent} : ''"></textarea>
					<button id="saveInfoBtn" class="saveInfoBtn">저장</button>
				</div>
			</div>
		</div>
		
		<div class="store-reserve">
			<a id="reserve-btn" class="btn" th:if="${session.member == null || session.member.memberLevel == 3}" href="#">예약하기</a>
		</div>
		
		<div class="store-review">
			<h2>리뷰</h2>
			<div class="store-review-list">
				
			</div>
			<button class="btn" id="more-btn">더보기</button>
		</div>
		<!-- 주변 맛집 슬라이드 -->
	</div>
	
	<script>
	   	//지도를 그려주는 함수 실행
	   		selectMapList();
		// 페이지 로드 시 실행되는 함수(store.storeAddr 값을 가져와서 searchAddressToCoordinate 전달)
   		$(document).ready(function() {
      		searchAddressToCoordinate("[[${store.storeAddr}]]");
  		});

   		$(document).ready(function() {
     		  $("#reserve-btn").click(function(e) {
     		      /* Thymeleaf를 사용하여 세션의 회원 정보를 확인 */
     		      const loggedIn = [[${session.member != null}]];
     		      /* 만약 로그인 되어 있지 않다면 */
     		      if (!loggedIn) {
     		          e.preventDefault(); // 기본 이벤트(링크 이동) 방지
     		          alert("회원 로그인 후 이용해주세요."); // 알림 메시지 출력
     		      }
     		  });
     		});
   		
   		// 저장 버튼 클릭 시 Ajax 요청 보내기
   	    $(document).ready(function() {
   	        $('#saveInfoBtn').click(function() {
   	            var infoContent = $('#infoContent').val(); // 텍스트 에어리어의 내용 가져오기
   	            // Ajax 요청 보내기
   	            $.ajax({
   	                url: '/search/updateInfo', // 서버의 엔드포인트 URL
   	                type: 'POST', // HTTP 요청 메서드 (POST를 사용할 경우)
   	                data: { infoContent: infoContent }, // 전송할 데이터
   	                success: function(response) {
   	                    alert('저장되었습니다.'); // 성공 시 알림 메시지 표시
   	                },
   	                error: function(xhr, status, error) {
   	                    console.error('에러:', error); // 오류가 발생한 경우 콘솔에 로그 출력
   	                }
   	            });
   	        });
   	    });
	</script>
	
	<th:block th:include="common/footer"></th:block>
</body>
</html>